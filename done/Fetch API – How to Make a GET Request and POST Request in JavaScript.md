في الكثير من الأوقات قد ترغب أن تجعل النظام "system" يتواصل مع سيرفرات الويب الأخرى للحصول على المعلومات.

كمثال: دعونا نفترض أنه مستخدم جديد يريد تسجيل حساب على موقعك، وبدلًا من ملئ الإستمارة بشكل يدوي وإرسالها إلى الخادم الخاص بك، يريد المستخدم أن يسجل بإستخدام معلوماته الموجودة بالفعل في خدمة أو منصة أخرى (هذا ما يسمى بالـ"***3rd party authentication***").

يجب على النظام "system" (او الخادم) الخاص بك في تلك الحالة التواصل مع الخادم الخاص بالـ"3rd Party" ليجلب تلك المعلومات، وسيحدث ذلك من خلال ما يسمى بالـ "***API***".

الـ "API" هو إختصار لمصطلح "Application Programming Interface"، هي عبارة عن مجموعة من القواعد وهي تحدد كيفية تواصل برنامج أو خادم مع الآخر.

![](https://www.freecodecamp.org/news/content/images/2021/05/IMG_20210530_115853.jpg)

مثال توضيحي للـAPI مكتوب بخط يدي

إذا كان برنامجك يتكون من صفحة واحدة ومكتوب بلغة لامتزامنة [asynchronous] مثل لغة الجافا سكربت، فمتاح لك أداة مفيدة لذلك الغرض:`fetch()`.

## ما هي الـ Fetch API؟

`fetch()` هي آلية تسمح لك أن تنفذ عمليات AJAX (Asynchronous JavaScript and XML) calls بسيطة بإستخدم الجافا سكربت .

**لامتزامنة** يعني أنها تمكنك من إستخدام fetch لتنفيذ عملية call إلى API خارجي بدون التأثير على تنفيذ عمليات أخرى. بتلك الطريقة، ستستمر الدَالاّت "functions" الأخرى في العمل حتى إذا فشلت عملية API call.

عندما يتم إرسال إستجابة "response" (تحتوي على data) من قبل الـ API، العمليات اللامتزامنة (fetch) تستكمل العمل. إذا ما قرأته للتو يبدو صعبًا، يمكنك  الإطلاع على [مدخل إلى الكود اللامتزامن الذي كتبته هنا](https://ubahthebuilder.tech/introduction-to-asynchronous-programming-with-javascript). 

من المهم ملاحظة أنه "fetch" ليس جزءًا من مواصفات الجافا سكربت، بل هو جزء من مواصفات الـ "WHATWG". بناءًا على ذلك، لن يمكنك إستخدامه في بيئة "Node.js" دون تثبيت "module" مخصصة.

## كيفية إستخدام `fetch()` في الجافا سكربت

عند التحدث عن الـ"API" يجب أن نذكر ماهي الـ**endpoints**. والـ "endpoint" هو ببساطة عنوان ويب مميز يمكنك إرسال له "call" لكي يتواصل مع خادم أخر.

دعنا نفترض أننا نرسل طلب "request" إلى API خارجي "External APIs" لكي نجلب بعض البيانات (مثال: مقال مدونة)، لكي نحقق ذلك، سنستخدم طلب جلب (GET Request) بسيط.

ببساطة ستستخدم آلية `fetch()` مع استخدام عنوان ويب الـ "endpoint" كمُعطى (argument). 
```js
fetch('https://ubahthebuilder.tech/posts/1');
```

محاولة جلب مقال مدونة من API خارجي. 

محتوى الإستجابة "response body" لتلك الـ"endpoint" ستحتوى على معلومات عن مقال مدونة:
```js
{
userId: 1,
id: 1,
title: 'A post by Kingsley',
body: 'Brilliant post on fetch...',
};
```


الهدف الجوهري هو الحصول على محتوى الإستجابة. لكن كائن الإستجابة "response object" يحتوي على العديد من المعلومات بجانب المحتوى "body"، يتضمن ذلك رقم الحالة "status code"، الرَوَاسٍ "headers"، ومعلومات أخرى.
> لاحظ أنه الـ"fetch API" تعطينا "Promise". لذلك، تحتاج أن تقترنها بـ then() ميثود "method" لكي تتعامل من خلالها مع الـ "resolution". يمكنك معرفة أكثر عن الـ"Promises" [من هنا](https://ubahthebuilder.tech/introduction-to-asynchronous-programming-with-javascript). 

البيانات المستلمة من الـ"API" لا تكون عادةً بنوعية نستطيع إستخدامها. لذلك ستحتاج إلى تحويل تلك البيانات إلى نوعية أخرى لإستخدامها مع الجافا سكربت. لحسن الحظ، يمكنك استخدام الـ"method" التالي:  `json()`  لتنفيذ ذلك. 

```js
fetch('https://ubahthebuilder.tech/posts/1')
.then(data => {
return data.json();
})
.then(post => {
console.log(post.title);
});
```

جلب مقال مدونة من الـ"API" واستخراج خاصية "property" العنوان "title" فقط.

كما ترى في الكود أعلاه، يمكنك إقران "method" يسمى `then()` لتحليل البيانات (في هذه الحالة استخرجنا العنوان فقط).

في هذا المثال، أردنا الحصول ببساطة على مقال مدونة من الـ"API". لكن ماذا إذا أردنا عوضًا عن ذلك أن ننشر مقالة. 

## كيفية إنشاء "POST Request"

بمجرد أن تنتقل من الـ"GET Requests"، ستحتاج أن تحدد بعض الخيارات "options" الأخرى. حتى الأن، لقد قمت بإضافة "argument" واحدة إلى `fetch()` — الـ"endpoint" الخاص بالرابط.

لتنفيذ "POST Request"، يجب أن نعطي كائن "object" يحتوي على تشكيل الخيارات "configuration options" كـ"argument" ثانوي. ذلك الكائن هو اختياري ويمكنه استقبال العديد من الـ"parameters" المختلفة. في تلك الحالة، يمكنك ضمن المعلومات المهمة فقط. 

لأنك ستقوم بإرسال "POST Request"، ستحتاج لإدلاء ذلك بإستخدام "method" بقيمة "POST". 

ستحتاج أيضًا بتمرير بعض البيانات لكي تنشئ مقال المدونة. بما إن ما تقوم إرساله هي بيانات من نوعية "JSON"، ستحتاج تعيين "header" يسمى "_Content-Type_" بقيمة "_application/json_". وأخيرًا، ستحتاج الـ"body"، الذي سيكون "string" واحد يحتوي على بيانات من نوعية "JSON". 


```js
const update = {
title: 'A blog post by Kingsley',
body: 'Brilliant post on fetch API',
userId: 1,
};

const options = {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify(update),
};
```

وبعد ذلك، نقوم بعملية "API call":
```js
fetch('https://jsonplaceholder.typicode.com/posts', options)
  .then(data => {
      if (!data.ok) {
        throw Error(data.status);
       }
       return data.json();
      }).then(update => {
      console.log(update);
      // {
      //
      title: 'A blog post by Kingsley',
      //
      body: 'Brilliant post on fetch API',
      //
      userId: 1,
      //
      id: 101
      // };
      }).catch(e => {
      console.log(e);
      });
```





إذا كانت الـ"request" الخاصة بك ناجحة، ستحصل على "response body" يحتوي على مقال المدونة مع رقم مميز "ID" جديد. تلك الـ"Response" سيختلف شكلها طبقًا لإعدادات الـAPI الذي تتعامل معه.

أخيرًا، لاحظ أنه الـ"endpoints" من الممكن أن تتغير مع الوقت ويمكن لذلك الـ"API" أن تتغير تركيبته. لذلك يجب عليك وضع جميع الـ"fetch calls" مع بعضهم البعض لجعل إمكانية التعديل أسهل. 

## ختام
بعض النقاط التي تلخص هذا المقال:


-   أنظمة الكمبيوتر مثل البرامج "software" تتواصل مع بعضها البعض وتتشارك المعلومات من خلال طبقة تسمى الـ"API".
- الـ"API" تحتوي على مجموعة من القواعد والبروتوكولات لإرشاد كيفية نظامين (خادومين) أو أكثر قد يمكنهم التواصل. كمثال، الخادوم الخاص بـ "فيس بوك" من الممكن أن يتواصل مع الخادوم الخاص بـ "جوجل" لكي يحصل على معلومات مستخدم من خلال "API".
-   عند إستخدام الجافا سكربت مع الواجهة "Front-end"، يمكنك تنفيذ عمليات "API Calls" بسيطة مع أداة تسمى `fetch()`. 
-   لإنشاء عملية "GET Request" بسيطة، تحتاج إلى تمرير الـ"endpoint" الخاص بالرابط (URL Endpoint) كـ"argument".
-   لإنشاء عملية "POST Request"، ستحتاج بجانب ذلك إلى تمرير بعض الـ"parameters" الأخرى وذلك يتضمن كائن "object" يحتوي على تشكيل الإختيارات "configuration options". 

إذا أعجبك مقالي وتريد أن تدعمني، فضلاً، يمكنك أن [تشتري لي قهوة](https://buymeacoffee.com/ubahthebuilder).

شكرًا لك ولنا لقاء أخر.
